<div class="container-fluid" style="position: absolute; top: 30%; width: 100%">
	<div class="row">
		<app-facturacion></app-facturacion>
	</div>	
</div>
<app-topnav></app-topnav>
<div class="container-fluid">
	<div class="row">
		<div class="col-sm-3 content-nav">
			<app-control-nav></app-control-nav>
		</div>
		<div class="col-sm-9 content-form">			
			<section>
					<header>
						<h4>Notas</h4>
					</header>
					<div class="row">
						<div class="buttons">
							<button class="btn btn-default" 
								[disabled]="disableButtonHistorial"
								(click)="showModal('notas')" 
								>Ver Historial Notas de Nutricionista</button>
						</div>
					</div>
				<div class="form-group">
					
					<label for="dieta_notas">Notas finales</label>
					<textarea 
						id="dieta_notas"
						name="dieta_notas"
						class="form-control" 
						rows="5"						
						maxlength="1000" 
						[(ngModel)]="consulta.notas"
					></textarea>
				</div>
				<ng-template [ngIf]="archivos">
					<ul class="lista-examen navbar">
				<ng-template ngFor let-item_archivo [ngForOf]= "archivos">
					<ng-template [ngIf]="item_archivo.owner=='nutricionista'">
						<li>
							<a href="{{item_archivo.filename}}" target="_blank">
								<i></i>
								<span>{{item_archivo.fecha}}</span>
							</a>
						</li>
					</ng-template>
				</ng-template>
					</ul>					
				</ng-template>
				<div class="container-form container-fluid">
						<div class="actions">
							<label for="archivo" class="form-open"><i></i>Añadir Archivo</label>
						</div>
						<form #uploadForm="ngForm" (ngSubmit)="onSubmit('nutricionista')" method="post" enctype="multipart/form-data">
							<div class="form-group">
								<input style="visibility:hidden" type="file" #fileupload id="archivo" name="archivo" (change)="fileChange($event, 'nutricionista')"/>
								<div *ngIf="sending" class="loading-file">cargando... <span class="fa fa-spinner fa-spin"></span></div>
							</div>
						</form>
					</div>
			</section>		
			<section>
					<header>
						<h4>Notas para el Paciente</h4>
					</header>			
					<div class="row">
						<div class="buttons">
							<button class="btn btn-default" 
								[disabled]="disableButtonHistorial"
								(click)="showModal('notas_paciente')" 
								>Ver Historial Notas para el Paciente</button>
						</div>
					</div>
				<div class="form-group">					
					<label for="dieta_notas">Notas finales</label>
					<textarea 
						id="dieta_notas"
						name="dieta_notas_paciente"
						class="form-control" 
						rows="5"						
						maxlength="1000" 
						[(ngModel)]="consulta.notas_paciente"
					></textarea>
				</div>
				<ng-template [ngIf]="archivos">
					<ul class="lista-examen navbar">
				<ng-template ngFor let-item_archivo [ngForOf]= "archivos">
					<ng-template [ngIf]="item_archivo.owner=='paciente'">
						<li>
							<a href="{{item_archivo.filename}}" target="_blank">
								<i></i>
								<span>{{item_archivo.fecha}}</span>
							</a>
						</li>
					</ng-template>
				</ng-template>
					</ul>					
				</ng-template>
				<div class="container-form container-fluid">
						<div class="actions">
							<label for="archivo1" class="form-open"><i></i>Añadir Archivo</label>
						</div>
						<form #uploadForm1="ngForm" (ngSubmit)="onSubmit('paciente')" method="post" enctype="multipart/form-data">
							<div class="form-group">
								<input style="visibility:hidden" type="file" #fileupload1 id="archivo1" name="archivo1" (change)="fileChange($event, 'paciente')"/>
								<div *ngIf="sending" class="loading-file">cargando... <span class="fa fa-spinner fa-spin"></span></div>
							</div>
						</form>
					</div>
			</section>
			
			<div class="buttons-navigation">
				<button 
					class="btn btn-default previous" 
					[disabled]="finalizar"
					(click)="Previous()"
				> ANTERIOR 
				</button>
				<button class="btn btn-success next"
					[disabled]="finalizar"
					(click)="Next()"
					> FINALIZAR  <span *ngIf="finalizar" class="fa fa-spinner fa-spin"></span>
					</button>
			</div>
			
		</div>
	</div>
</div>
<div class="esc-modalbox prompt" *ngIf="!hidePrompt">
	<a class="modal-close" (click)="promptCancelar()"><i></i></a>
	<header class="text-center">
		<h4>¿Desea crear factura electr&oacute;nica para esta consulta?</h4>
	</header>
	<div class="body row">
		<div class="col-xs-6">
			<button class="btn btn-default btn-block" (click)="promptYes()">SI</button>
		</div>
		<div class="col-xs-6">
			<button class="btn btn-default btn-block red" (click)="promptCancelar()">No</button>
		</div>
	</div>
</div>
<div class="overlay" (click)="hideModal()"></div>
<div [ngClass]="{'invisible ': hideModalDatos }" class="esc-modalbox wide">
	<a class="modal-close" (click)="hideModal('notas')"><i></i></a>
	<div class="body">
		<header class="text-center">
			<h4 *ngIf="!showHistorialPaciente">Historial Notas de Consultas</h4>
			<h4 *ngIf="showHistorialPaciente">Historial Notas para Paciente</h4>
		</header>
			<div class="table-responsive">
				<table class="table separate table-mobile historial notas">
					<thead>
						<tr>
							<th width="100">Fecha</th>
							<th>Notas</th>
							<th>Archivos</th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let historia of historialNotas">
							<td>{{historia.fecha | date: 'dd/MM/yyyy'}}</td>
							<td>
								<span *ngIf="!showHistorialPaciente">{{historia.notas}}</span>
								<span *ngIf="showHistorialPaciente">{{historia.notas_paciente}}</span>
							</td>
							<td>
								<ng-template [ngIf]="historialNotas[0].archivos">
									<ul class="lista-examen navbar">
									<ng-template ngFor let-item [ngForOf]= "historialNotas[0].archivos">
										<ng-template [ngIf]="item.owner=='nutricionista'">
										<li *ngIf="!showHistorialPaciente">
											<a href="{{item.filename}}" target="_blank">
												<i></i>
											</a>
										</li>
										</ng-template>
										<ng-template [ngIf]="item.owner=='paciente'">
										<li *ngIf="showHistorialPaciente">
											<a href="{{item.filename}}" target="_blank">
												<i></i>
											</a>
										</li>
										</ng-template>
									</ng-template>
									</ul>					
								</ng-template>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
	</div>
</div>

